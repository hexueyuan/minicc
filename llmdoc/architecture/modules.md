# æ¨¡å—æ¶æ„

## æ¨¡å—ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   app.py    â”‚  TUI å…¥å£
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  agent.py   â”‚â”€â”€â”€â”€â–¶â”‚  tools.py   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  config.py  â”‚     â”‚ schemas.py  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ¨¡å—èŒè´£

### schemas.py (128 è¡Œ)
æ•°æ®æ¨¡å‹å®šä¹‰ï¼Œæ‰€æœ‰ Pydantic æ¨¡å‹é›†ä¸­ç®¡ç†ã€‚

**å…³é”®ç±»:**
- `Config`: åº”ç”¨é…ç½®ç»“æ„
- `Provider`: LLM æä¾›å•†æšä¸¾
- `ToolResult`: å·¥å…·æ‰§è¡Œç»“æœ
- `DiffLine`: Diff è¡Œä¿¡æ¯
- `MiniCCDeps`: Agent ä¾èµ–æ³¨å…¥å®¹å™¨

### config.py (155 è¡Œ)
é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œå¤„ç† ~/.minicc ç›®å½•ã€‚

**å…³é”®å‡½æ•°:**
- `load_config()`: åŠ è½½é…ç½®
- `save_config()`: ä¿å­˜é…ç½®
- `load_agents_prompt()`: åŠ è½½ç³»ç»Ÿæç¤ºè¯
- `get_api_key()`: è·å– API å¯†é’¥

### tools.py (494 è¡Œ)
å·¥å…·å‡½æ•°å®ç°ï¼Œå®šä¹‰æ‰€æœ‰å¯ä¾› Agent è°ƒç”¨çš„å·¥å…·ã€‚

**å·¥å…·åˆ†ç±»:**
- æ–‡ä»¶æ“ä½œ: read_file, write_file, update_file
- æœç´¢: search_files, grep
- å‘½ä»¤è¡Œ: bash
- å­ä»»åŠ¡: spawn_agent, get_agent_result

### agent.py (148 è¡Œ)
Agent å®šä¹‰ï¼Œä½¿ç”¨ pydantic-ai åˆ›å»ºå’Œé…ç½®ã€‚

**å…³é”®å‡½æ•°:**
- `create_model()`: åˆ›å»ºæ¨¡å‹æ ‡è¯†ç¬¦
- `create_agent()`: åˆ›å»ºå¹¶é…ç½® Agent
- `_build_tools()`: æ³¨å†Œå·¥å…·åˆ° Agent

### app.py (242 è¡Œ)
Textual TUI ä¸»åº”ç”¨ï¼Œå¤„ç†ç”¨æˆ·äº¤äº’å’Œæ¶ˆæ¯æµå¤„ç†ã€‚

**å…³é”®åŠŸèƒ½:**
- æ¶ˆæ¯è¾“å…¥å’Œæ˜¾ç¤ºï¼ˆMessagePanelï¼‰
- æµå¼è¾“å‡ºå¤„ç†ï¼ˆå·¥å…·è°ƒç”¨å’Œå“åº”æ–‡æœ¬ï¼‰
- å¿«æ·é”®ç»‘å®šï¼ˆCtrl+C é€€å‡ºã€Ctrl+L æ¸…å±ã€Escape å–æ¶ˆï¼‰
- å·¥å…·è°ƒç”¨å›è°ƒå¤„ç†ï¼ˆToolCallLine / SubAgentLineï¼‰
- Token ä½¿ç”¨é‡è¿½è¸ªå’Œæ›´æ–°ï¼ˆBottomBar.add_tokensï¼‰

**å¸ƒå±€ç»“æ„:**
```
Header
â†“
chat_container (VerticalScroll) - æ¶ˆæ¯/å·¥å…·è°ƒç”¨/SubAgent
  â”œâ”€ MessagePanel: ç”¨æˆ·/åŠ©æ‰‹æ¶ˆæ¯
  â”œâ”€ ToolCallLine: å·¥å…·è°ƒç”¨ï¼ˆå•è¡Œç®€æ´ï¼‰
  â”œâ”€ SubAgentLine: SubAgent ä»»åŠ¡ï¼ˆå•è¡Œç®€æ´ï¼‰
  â””â”€ DiffView: æ–‡ä»¶å˜æ›´é¢„è§ˆ
â†“
Input - ç”¨æˆ·è¾“å…¥æ¡†
â†“
BottomBar - æ¨¡å‹/ç›®å½•/åˆ†æ”¯/Token
â†“
Footer
```

### ui/widgets.py (230 è¡Œ)
è‡ªå®šä¹‰ UI ç»„ä»¶é›†åˆï¼Œå·²ç²¾ç®€ä¸ºæ ¸å¿ƒç»„ä»¶ã€‚

**ä¿ç•™çš„ç»„ä»¶:**
- `MessagePanel` (è¡Œ 15-41): æ¶ˆæ¯é¢æ¿ï¼Œæ”¯æŒ Markdown æ¸²æŸ“å’Œè§’è‰²åŒºåˆ†
- `ToolCallLine` (è¡Œ 44-85): å·¥å…·è°ƒç”¨å•è¡Œæ˜¾ç¤º `ğŸ”§ tool_name (param) âœ…/âŒ`
- `SubAgentLine` (è¡Œ 87-127): SubAgent å•è¡Œæ˜¾ç¤º `ğŸ¤– prompt_summary â³/ğŸ”„/âœ…/âŒ`
- `DiffView` (è¡Œ 129-189): Diff æ˜¾ç¤ºï¼Œé¢œè‰²åŒºåˆ†æ·»åŠ /åˆ é™¤/ä¸Šä¸‹æ–‡
- `BottomBar` (è¡Œ 191-230): åº•è¾¹æ ï¼Œåˆ†åŒºå—æ˜¾ç¤ºæ¨¡å‹/ç›®å½•/åˆ†æ”¯/Token

**å·²ç§»é™¤çš„ç»„ä»¶:**
- `ToolCallPanel` â†’ è¢« `ToolCallLine` æ›¿ä»£ï¼ˆæ›´ç®€æ´ï¼‰
- `SubAgentPanel` â†’ è¢« `SubAgentLine` æ›¿ä»£
- `UsageDisplay` â†’ åŠŸèƒ½é›†æˆåˆ° `BottomBar`
- `StatusBar` â†’ åŠŸèƒ½å·²å¼ƒç”¨
- `CollapsibleToolPanel` â†’ è¢« `ToolCallLine` æ›¿ä»£
